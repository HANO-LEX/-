<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸŒ™ Ø£Ù‡Ø¯Ø§ÙÙŠ ÙÙŠ Ø±Ù…Ø¶Ø§Ù†</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<style>
/* ===== VARIABLES ===== */
:root {
  --gold:#c9a84c; --gold-light:#e8c97a; --gold-dark:#9a7a2e;
  --tr:0.3s cubic-bezier(0.4,0,0.2,1);
}
[data-theme="light"] {
  --bg:#f7f3eb; --bg2:#ede6d6; --bg3:#e0d5c0; --card:#fffdf7;
  --text:#2c1f0e; --text2:#5a4a2e; --text3:#8a7a5e;
  --border:rgba(180,150,80,0.25); --shadow:0 4px 20px rgba(100,70,20,0.1);
  --sbg:linear-gradient(160deg,#2d1a0a,#1a3a2a);
  --stxt:#e8d5aa; --pat:0.04; --accent:#c9a84c;
  --green:#2d7a4a; --gl:#e8f5ee; --red:#c0392b; --rl:#fde8e6;
}
[data-theme="dark"] {
  --bg:#0d1117; --bg2:#161b22; --bg3:#1e2530; --card:#1a2235;
  --text:#e8d5aa; --text2:#c9b88a; --text3:#8a9ab5;
  --border:rgba(200,168,76,0.2); --shadow:0 4px 20px rgba(0,0,0,0.35);
  --sbg:linear-gradient(160deg,#060b10,#0a1f14);
  --stxt:#e8d5aa; --pat:0.06; --accent:#e8c97a;
  --green:#4caf80; --gl:#0d2a1a; --red:#e05a50; --rl:#2a0d0a;
}
[data-theme="pink"] {
  --bg:#fdf0f5; --bg2:#f9e0ec; --bg3:#f4cedf; --card:#fff8fb;
  --text:#4a1228; --text2:#7a3050; --text3:#aa7090;
  --border:rgba(200,100,150,0.2); --shadow:0 4px 20px rgba(180,60,120,0.1);
  --sbg:linear-gradient(160deg,#3a0a1e,#1a0a2a);
  --stxt:#fce8f2; --pat:0.05; --accent:#e0709a;
  --green:#c04070; --gl:#fce8f2; --red:#e05080; --rl:#fde8ee;
}

/* ===== RESET ===== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  font-family: 'Cairo', sans-serif;
  background: var(--bg); color: var(--text);
  min-height: 100dvh; overflow-x: hidden;
  transition: background var(--tr), color var(--tr);
}
/* dot pattern â€” no stacking context, no z-index */
body::before {
  content: ''; position: fixed; inset: 0; pointer-events: none;
  background-image:
    radial-gradient(circle at 25% 25%, var(--gold) 1px, transparent 1px),
    radial-gradient(circle at 75% 75%, var(--gold) 1px, transparent 1px);
  background-size: 40px 40px; opacity: var(--pat);
}

/* ===== OVERLAY â€” directly on body, high z-index ===== */
#overlay {
  display: none;
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 400;
}
#overlay.open { display: block; }

/* ===== SIDEBAR â€” directly on body, above overlay ===== */
#sidebar {
  position: fixed; top: 0; right: -100%;
  width: min(290px, 85vw); height: 100dvh;
  background: var(--sbg); color: var(--stxt);
  z-index: 500;
  transition: right var(--tr);
  overflow-y: auto; overflow-x: hidden;
  display: flex; flex-direction: column;
}
#sidebar.open { right: 0; }

.sb-head {
  display: flex; align-items: center; justify-content: space-between;
  padding: 18px 14px 14px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  position: sticky; top: 0; background: inherit;
}
.sb-head h2 { font-family:'Amiri',serif; font-size:1.1rem; color:var(--gold); }
.btn-close {
  background: none; border: none; color: var(--stxt);
  font-size: 1.3rem; cursor: pointer; padding: 4px 8px;
  border-radius: 6px; line-height: 1;
}

.sb-tabs { display: flex; gap: 8px; padding: 12px 12px 0; }
.tab-btn {
  flex: 1; padding: 8px 4px; border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.15); background: transparent;
  color: var(--stxt); font-family: 'Cairo',sans-serif; font-size: 0.8rem;
  cursor: pointer; transition: all var(--tr); opacity: 0.65;
}
.tab-btn.active {
  background: var(--gold); color: #1a0a00;
  border-color: var(--gold); opacity: 1; font-weight: 700;
}
.tab-pane { display: none; padding: 12px; }
.tab-pane.active { display: block; }

/* New Day */
.new-day-btn {
  width: 100%; margin: 10px 0 4px; padding: 12px;
  border-radius: 12px; border: none;
  background: linear-gradient(135deg, var(--gold-dark), var(--gold));
  color: #1a0a00; font-family: 'Cairo',sans-serif;
  font-size: 0.9rem; font-weight: 900; cursor: pointer;
  display: flex; align-items: center; justify-content: center; gap: 6px;
  box-shadow: 0 4px 14px rgba(201,168,76,0.3);
  transition: transform var(--tr), box-shadow var(--tr);
}
.new-day-btn:hover { transform: translateY(-1px); }
.new-day-btn:active { transform: scale(0.97); }

/* Days list */
.days-list { display: flex; flex-direction: column; gap: 7px; margin-top: 4px; }
.day-item {
  display: flex; align-items: center; gap: 8px;
  padding: 9px 11px; border-radius: 11px;
  background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
  cursor: pointer; transition: all var(--tr);
}
.day-item:hover, .day-item.active {
  background: rgba(201,168,76,0.2); border-color: var(--gold);
}
.day-badge {
  width: 30px; height: 30px; border-radius: 8px;
  background: var(--gold); color: #1a0a00;
  font-size: 0.78rem; font-weight: 900;
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
}
.day-info { flex: 1; min-width: 0; }
.day-title { font-size: 0.83rem; font-weight: 700; }
.day-sub { font-size: 0.66rem; opacity: 0.5; margin-top: 1px; }
.day-score { font-size: 0.78rem; font-weight: 700; color: var(--gold); flex-shrink: 0; }
.day-del {
  background: none; border: none; cursor: pointer;
  font-size: 0.9rem; padding: 4px 7px; border-radius: 7px;
  opacity: 0.4; transition: all var(--tr); flex-shrink: 0;
}
.day-del:hover { opacity: 1; background: rgba(220,60,60,0.2); }

/* Stats */
.stat-sec { margin-bottom: 14px; }
.stat-ttl {
  font-size: 0.78rem; color: var(--gold); font-weight: 700;
  margin-bottom: 8px; border-right: 2px solid var(--gold); padding-right: 7px;
}
.stat-row {
  background: rgba(255,255,255,0.05); border-radius: 9px;
  padding: 9px 11px; margin-bottom: 7px; border: 1px solid rgba(255,255,255,0.08);
}
.stat-rh { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
.stat-lbl { font-size: 0.76rem; opacity: 0.75; }
.stat-val { font-size: 0.76rem; font-weight: 700; color: var(--gold); }
.bar-bg { height: 5px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; }
.bar-fill { height: 100%; background: linear-gradient(90deg, var(--gold-dark), var(--gold)); border-radius: 3px; transition: width 0.5s; }
.cmp-row { display: grid; grid-template-columns: 1fr 1fr; gap: 7px; margin-bottom: 7px; }
.cmp-card {
  background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08);
  border-radius: 9px; padding: 9px; text-align: center;
}
.cmp-lbl { font-size: 0.62rem; opacity: 0.55; margin-bottom: 3px; }
.cmp-val { font-size: 1.3rem; font-weight: 900; color: var(--gold); }
.cmp-sub { font-size: 0.58rem; opacity: 0.45; }
.trend {
  display: inline-flex; align-items: center; gap: 3px;
  padding: 3px 9px; border-radius: 20px; font-size: 0.7rem; font-weight: 700; margin-top: 5px;
}
.trend-up { background: rgba(76,175,80,0.2); color: #4caf80; }
.trend-dn { background: rgba(224,90,80,0.2); color: #e05a50; }
.trend-eq { background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.55); }
.wchart { display: flex; align-items: flex-end; gap: 3px; height: 56px; margin-top: 7px; }
.wbar-w { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 3px; height: 100%; }
.wbar-c { flex: 1; width: 100%; background: rgba(255,255,255,0.08); border-radius: 3px; display: flex; align-items: flex-end; overflow: hidden; }
.wbar { width: 100%; background: linear-gradient(0deg, var(--gold-dark), var(--gold)); border-radius: 3px; min-height: 2px; transition: height 0.5s; }
.wbar-l { font-size: 0.52rem; opacity: 0.55; }

/* ===== APP WRAPPER ===== */
#app {
  max-width: 520px; margin: 0 auto;
  min-height: 100dvh;
  display: flex; flex-direction: column;
}

/* ===== TOPBAR ===== */
.topbar {
  position: sticky; top: 0;
  background: var(--card);
  border-bottom: 1px solid var(--border);
  box-shadow: var(--shadow);
  padding: 11px 14px;
  display: flex; align-items: center; justify-content: space-between;
  z-index: 10;
}
.tb-title {
  font-family: 'Amiri',serif; font-size: 1.1rem; font-weight: 700;
  color: var(--accent); display: flex; align-items: center; gap: 6px;
}
.tb-actions { display: flex; align-items: center; gap: 6px; }
.theme-row { display: flex; gap: 3px; }
.tbtn {
  width: 31px; height: 31px; border-radius: 9px;
  border: 2px solid transparent; background: var(--bg2);
  display: flex; align-items: center; justify-content: center;
  font-size: 1.1rem; cursor: pointer; transition: all var(--tr);
}
.tbtn:hover { border-color: var(--accent); transform: scale(1.08); }
.tbtn.active { border-color: var(--accent); background: var(--bg3); }
.tbtn.light { color: #e8a000; }
.tbtn.dark  { color: #b8ccee; }
.tbtn.pink  { color: #e05080; }
.menu-btn {
  width: 36px; height: 36px; border-radius: 10px;
  border: 1px solid var(--border); background: var(--bg2); color: var(--text);
  display: flex; align-items: center; justify-content: center;
  font-size: 1.1rem; cursor: pointer; transition: all var(--tr);
}
.menu-btn:hover { background: var(--accent); color: #fff; }
.moon { font-size: 1.15rem; display: inline-block; animation: mf 3s ease-in-out infinite; }
@keyframes mf { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-3px)} }

/* ===== MAIN ===== */
.main { flex: 1; padding: 14px; }

.hero {
  background: var(--card); border-radius: 18px;
  border: 1px solid var(--border); box-shadow: var(--shadow);
  padding: 18px 20px; margin-bottom: 14px;
  text-align: center; position: relative; overflow: hidden;
}
.hero::before {
  content: ''; position: absolute; top: -28px; right: -28px;
  width: 110px; height: 110px; border-radius: 50%;
  background: radial-gradient(circle, var(--accent), transparent 70%); opacity: 0.1;
}
.hero-date { font-family:'Amiri',serif; font-size: 1.4rem; color: var(--accent); margin-bottom: 3px; }
.hero-sub  { font-size: 0.74rem; color: var(--text3); }
.prog-row  { display: flex; align-items: center; gap: 9px; margin-top: 12px; }
.prog-lbl  { font-size: 0.73rem; color: var(--text3); white-space: nowrap; }
.prog-bar  { flex: 1; height: 7px; background: var(--bg3); border-radius: 4px; overflow: hidden; min-width: 0; }
.prog-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--gold-light)); border-radius: 4px; transition: width 0.4s; }
.prog-pct  { font-size: 0.78rem; font-weight: 700; color: var(--accent); min-width: 32px; }

.sec-title {
  font-family: 'Amiri',serif; font-size: 1.05rem; color: var(--text);
  display: flex; align-items: center; gap: 7px; margin-bottom: 11px;
}
.sec-title::after { content:''; flex:1; height:1px; background: var(--border); }

.tasks { display: flex; flex-direction: column; gap: 10px; }

.card {
  background: var(--card); border-radius: 15px;
  border: 1px solid var(--border); box-shadow: var(--shadow);
}
.card-head {
  display: flex; align-items: center; gap: 10px;
  padding: 12px 14px; cursor: pointer; user-select: none;
}
.card-icon {
  width: 40px; height: 40px; border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.2rem; flex-shrink: 0;
}
.ic-fast { background: linear-gradient(135deg,#1a3a2a,#2d7a4a); }
.ic-pray { background: linear-gradient(135deg,#1a2a3a,#2d4a7a); }
.ic-quran{ background: linear-gradient(135deg,#3a2a1a,#7a5a2d); }
.ic-study{ background: linear-gradient(135deg,#2a1a3a,#5a2d7a); }
[data-theme="pink"] .ic-fast  { background: linear-gradient(135deg,#3a1a2a,#7a3050); }
[data-theme="pink"] .ic-pray  { background: linear-gradient(135deg,#2a1a3a,#6030a0); }
[data-theme="pink"] .ic-quran { background: linear-gradient(135deg,#3a1020,#a03060); }
[data-theme="pink"] .ic-study { background: linear-gradient(135deg,#1a1a3a,#4040a0); }
.card-info { flex: 1; min-width: 0; }
.card-name { font-size: 0.9rem; font-weight: 700; color: var(--text); }
.card-sub  {
  font-size: 0.68rem; color: var(--text3); margin-top: 2px;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.card-arr {
  width: 22px; height: 22px; border-radius: 6px;
  background: var(--bg2); border: 1px solid var(--border);
  display: flex; align-items: center; justify-content: center;
  font-size: 0.65rem; color: var(--text3); flex-shrink: 0;
}
.card-body { padding: 0 14px 12px; border-top: 1px solid var(--border); }

/* Fasting */
.fast-row { display: flex; gap: 8px; margin-top: 11px; }
.fast-btn {
  flex: 1; padding: 10px 6px; border-radius: 11px;
  border: 2px solid var(--border); background: var(--bg2);
  color: var(--text2); font-family: 'Cairo',sans-serif;
  font-size: 0.82rem; font-weight: 600; cursor: pointer;
  transition: all var(--tr);
  display: flex; align-items: center; justify-content: center; gap: 5px;
}
.fast-btn.sel-yes { border-color:var(--green); background:var(--gl); color:var(--green); }
.fast-btn.sel-no  { border-color:var(--red);   background:var(--rl); color:var(--red); }

/* Prayers */
.pray-list { margin-top: 11px; }
.pray-item {
  display: flex; align-items: center; justify-content: space-between;
  padding: 8px 0; border-bottom: 1px solid var(--border);
}
.pray-item:last-child { border-bottom: none; }
.pray-name { font-size: 0.85rem; font-weight: 600; flex-shrink: 0; }
.pray-btns { display: flex; gap: 5px; }
.pray-btn {
  padding: 5px 10px; border-radius: 8px;
  border: 1px solid var(--border); background: var(--bg2);
  color: var(--text3); font-family: 'Cairo',sans-serif;
  font-size: 0.69rem; cursor: pointer; transition: all var(--tr); white-space: nowrap;
}
.pray-btn.on-done { background:var(--gl);  color:var(--green); border-color:var(--green); }
.pray-btn.on-qada { background:var(--rl);  color:var(--red);   border-color:var(--red); }

/* Quran */
.quran-body { margin-top: 11px; }
.counter-row {
  display: flex; align-items: center; gap: 10px;
  background: var(--bg2); border-radius: 12px;
  padding: 9px 12px; border: 1px solid var(--border);
}
.cnt-lbl { font-size: 0.76rem; color: var(--text2); }
.cnt-ctrl { display: flex; align-items: center; gap: 9px; margin-right: auto; }
.cnt-btn {
  width: 31px; height: 31px; border-radius: 9px; border: none;
  background: var(--accent); color: #fff; font-size: 1.1rem;
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  transition: transform var(--tr); flex-shrink: 0;
}
.cnt-btn:active { transform: scale(0.88); }
.cnt-val { font-size: 1.1rem; font-weight: 900; color: var(--accent); min-width: 26px; text-align: center; }

/* Study */
.study-body { margin-top: 11px; }
.study-row { display: flex; align-items: center; gap: 10px; margin-bottom: 9px; }
.study-lbl { font-size: 0.78rem; color: var(--text2); }
.hrs-ctrl { display: flex; align-items: center; gap: 8px; margin-right: auto; }
.hrs-val  { font-size: 1.05rem; font-weight: 900; color: var(--accent); min-width: 26px; text-align: center; }
.sbj-item {
  display: flex; align-items: center; gap: 8px;
  padding: 7px 0; border-bottom: 1px solid var(--border); cursor: pointer;
}
.sbj-item:last-child { border-bottom: none; }
.sbj-chk {
  width: 19px; height: 19px; border-radius: 5px;
  border: 2px solid var(--border); background: var(--bg2);
  display: flex; align-items: center; justify-content: center;
  font-size: 0.65rem; transition: all var(--tr); flex-shrink: 0;
}
.sbj-item.done .sbj-chk { background: var(--green); border-color: var(--green); color: #fff; }
.sbj-name { font-size: 0.81rem; flex: 1; }
.sbj-item.done .sbj-name { text-decoration: line-through; opacity: 0.45; }
.sbj-del { margin-right: auto; font-size: 0.66rem; opacity: 0.35; cursor: pointer; padding: 0 4px; }
.add-row { display: flex; gap: 6px; margin-top: 9px; }
.add-inp {
  flex: 1; padding: 7px 10px; border-radius: 9px;
  border: 1px solid var(--border); background: var(--bg2);
  color: var(--text); font-family: 'Cairo',sans-serif; font-size: 0.78rem;
  outline: none; min-width: 0;
}
.add-inp:focus { border-color: var(--accent); }
.add-btn {
  padding: 7px 12px; border-radius: 9px; border: none;
  background: var(--accent); color: #fff;
  font-family: 'Cairo',sans-serif; font-size: 0.78rem;
  cursor: pointer; white-space: nowrap;
}

/* Notes */
.notes-txt {
  width: 100%; padding: 9px 11px; border-radius: 11px;
  border: 1px solid var(--border); background: var(--bg2); color: var(--text);
  font-family: 'Cairo',sans-serif; font-size: 0.78rem;
  resize: none; outline: none; margin-top: 11px; min-height: 68px;
  transition: border-color var(--tr);
}
.notes-txt:focus { border-color: var(--accent); }

/* Save */
.save-btn {
  width: 100%; padding: 12px; border-radius: 13px; border: none;
  background: linear-gradient(135deg, var(--gold-dark), var(--accent));
  color: #fff; font-family: 'Cairo',sans-serif; font-size: 0.9rem; font-weight: 700;
  cursor: pointer; margin-top: 16px;
  display: flex; align-items: center; justify-content: center; gap: 6px;
  box-shadow: 0 4px 14px rgba(201,168,76,0.28); transition: all var(--tr);
}
.save-btn:hover  { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(201,168,76,0.38); }
.save-btn:active { transform: scale(0.98); }

/* Toast */
#toast {
  position: fixed; bottom: 18px; left: 50%;
  transform: translateX(-50%) translateY(70px);
  background: var(--card); border: 1px solid var(--border); border-radius: 11px;
  padding: 9px 18px; font-size: 0.82rem; font-weight: 600;
  box-shadow: var(--shadow); z-index: 600; transition: transform 0.28s ease;
  white-space: nowrap; pointer-events: none;
}
#toast.show { transform: translateX(-50%) translateY(0); }

/* Modal */
.modal-bg {
  position: fixed; inset: 0; background: rgba(0,0,0,0.55);
  z-index: 700;
  display: flex; align-items: center; justify-content: center; padding: 20px;
}
.modal-box {
  background: var(--card); border: 1px solid var(--border); border-radius: 18px;
  padding: 22px 18px; width: 100%; max-width: 290px;
  box-shadow: 0 18px 50px rgba(0,0,0,0.35); text-align: center;
}
.modal-ico { font-size: 2rem; margin-bottom: 9px; }
.modal-ttl { font-size: 0.95rem; font-weight: 700; margin-bottom: 5px; }
.modal-sub { font-size: 0.78rem; color: var(--text3); margin-bottom: 18px; }
.modal-row { display: flex; gap: 9px; }
.modal-btn {
  flex: 1; padding: 10px; border-radius: 11px; border: none;
  font-family: 'Cairo',sans-serif; font-size: 0.85rem; font-weight: 700; cursor: pointer;
}
.m-cancel  { background: var(--bg2); color: var(--text2); border: 1px solid var(--border); }
.m-del     { background: #e04040; color: #fff; }

/* Scrollbar */
::-webkit-scrollbar { width: 3px; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

/* ================================================================
   RESPONSIVE
   ================================================================ */
@media (max-width: 340px) {
  .topbar { padding: 9px 10px; }
  .tb-title { font-size: 0.9rem; }
  .tbtn { width: 26px; height: 26px; font-size: 0.95rem; }
  .menu-btn { width: 30px; height: 30px; }
  .main { padding: 10px; }
  .hero-date { font-size: 1.15rem; }
  .card-icon { width: 36px; height: 36px; font-size: 1.05rem; }
  .card-head { padding: 10px 11px; }
  .pray-btn { padding: 4px 6px; font-size: 0.63rem; }
}

@media (min-width: 480px) {
  #app { max-width: 580px; }
  .topbar { padding: 12px 20px; }
  .main { padding: 18px 20px; }
  .hero { padding: 20px 24px; }
  .hero-date { font-size: 1.55rem; }
  .card-head { padding: 13px 17px; }
  .card-icon { width: 45px; height: 45px; font-size: 1.3rem; }
  .card-name { font-size: 0.94rem; }
  .card-body { padding: 0 17px 13px; }
  #sidebar { width: min(310px, 85vw); }
  .save-btn { font-size: 0.94rem; }
}

/* Tablet 768+: sidebar becomes inline column */
@media (min-width: 768px) {
  /* Disable mobile sidebar behaviour */
  #overlay { display: none !important; }
  #sidebar {
    position: sticky !important;
    top: 0 !important; right: auto !important;
    width: 280px !important; min-width: 280px;
    height: 100dvh;
    z-index: 1 !important;
    transition: none !important;
    border-left: 1px solid rgba(255,255,255,0.09);
    flex-shrink: 0;
  }
  .btn-close { display: none; }
  .menu-btn  { display: none; }
  /* App becomes horizontal */
  #app {
    max-width: 100%; flex-direction: row; align-items: flex-start;
  }
  .main-col {
    flex: 1; display: flex; flex-direction: column;
    min-width: 0; min-height: 100dvh;
  }
  .topbar { padding: 13px 26px; }
  .main   { padding: 20px 28px; }
  .hero-date { font-size: 1.65rem; }
  .tasks { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .sec-title { font-size: 1.12rem; }
  .pray-btn { padding: 6px 12px; }
  .save-btn { font-size: 0.96rem; padding: 14px; }
  .notes-txt { min-height: 85px; }
}

@media (min-width: 1024px) {
  #sidebar { width: 310px !important; min-width: 310px; }
  .topbar { padding: 15px 38px; }
  .main   { padding: 26px 38px; }
  .hero-date { font-size: 1.9rem; }
  .card-head { padding: 15px 20px; }
  .card-icon { width: 50px; height: 50px; font-size: 1.4rem; }
  .card-body { padding: 0 20px 16px; }
}

@media (min-width: 1280px) {
  #sidebar { width: 340px !important; min-width: 340px; }
  .topbar { padding: 17px 48px; }
  .main   { padding: 30px 48px; }
}

/* Touch */
@media (hover:none) and (pointer:coarse) {
  .cnt-btn  { width: 36px; height: 36px; }
  .pray-btn { padding: 7px 10px; min-height: 34px; }
  .fast-btn { min-height: 44px; }
  .day-del  { opacity: 0.6; padding: 5px 9px; }
  .sbj-item { padding: 9px 0; }
}
</style>
</head>
<body data-theme="light">

<!-- OVERLAY (closes sidebar on tap outside) -->
<div id="overlay" onclick="closeSidebar()"></div>

<!-- SIDEBAR -->
<div id="sidebar">
  <div class="sb-head">
    <h2>ğŸŒ™ Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ…</h2>
    <button class="btn-close" onclick="closeSidebar()">âœ•</button>
  </div>
  <div class="sb-tabs">
    <button class="tab-btn active" onclick="switchTab('days')">ğŸ“… Ø§Ù„Ø£ÙŠØ§Ù…</button>
    <button class="tab-btn" onclick="switchTab('stats')">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
  </div>

  <div class="tab-pane active" id="tab-days">
    <button class="new-day-btn" onclick="addNewDay()">âœ¨ ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯</button>
    <div class="days-list" id="daysList"></div>
  </div>

  <div class="tab-pane" id="tab-stats">
    <div class="stat-sec">
      <div class="stat-ttl">ğŸ“ˆ Ø§Ù„ÙŠÙˆÙ… Ù…Ù‚Ø§Ø¨Ù„ Ø£Ù…Ø³</div>
      <div class="cmp-row">
        <div class="cmp-card">
          <div class="cmp-lbl">Ø§Ù„ÙŠÙˆÙ…</div>
          <div class="cmp-val" id="sTodayPct">0%</div>
          <div class="cmp-sub">Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ÙŠÙˆÙ…</div>
        </div>
        <div class="cmp-card">
          <div class="cmp-lbl">Ø£Ù…Ø³</div>
          <div class="cmp-val" id="sYestPct">0%</div>
          <div class="cmp-sub">Ø¥Ù†Ø¬Ø§Ø² Ø£Ù…Ø³</div>
        </div>
      </div>
      <div id="sTrend" style="text-align:center"></div>
    </div>
    <div class="stat-sec">
      <div class="stat-ttl">âœ… ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…</div>
      <div class="stat-row">
        <div class="stat-rh"><span class="stat-lbl">ğŸŒ… Ø§Ù„ØµÙˆÙ…</span><span class="stat-val" id="sFast">â€”</span></div>
      </div>
      <div class="stat-row">
        <div class="stat-rh"><span class="stat-lbl">ğŸ•Œ Ø§Ù„ØµÙ„Ø§Ø©</span><span class="stat-val" id="sPray">0/5</span></div>
        <div class="bar-bg"><div class="bar-fill" id="sPrayBar" style="width:0%"></div></div>
      </div>
      <div class="stat-row">
        <div class="stat-rh"><span class="stat-lbl">ğŸ“– Ø§Ù„Ù‚Ø±Ø¢Ù†</span><span class="stat-val" id="sQuran">0 ØµÙØ­Ø§Øª</span></div>
        <div class="bar-bg"><div class="bar-fill" id="sQuranBar" style="width:0%"></div></div>
      </div>
      <div class="stat-row">
        <div class="stat-rh"><span class="stat-lbl">ğŸ“š Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©</span><span class="stat-val" id="sStudy">0 Ø³Ø§Ø¹Ø§Øª</span></div>
        <div class="bar-bg"><div class="bar-fill" id="sStudyBar" style="width:0%"></div></div>
      </div>
    </div>
    <div class="stat-sec">
      <div class="stat-ttl">ğŸ“Š Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div>
      <div class="wchart" id="wChart"></div>
    </div>
    <div class="stat-sec">
      <div class="stat-ttl">ğŸ“‹ Ù…Ù„Ø®Øµ</div>
      <div class="cmp-row">
        <div class="cmp-card">
          <div class="cmp-lbl">Ù…ØªÙˆØ³Ø· Ø£Ø³Ø¨ÙˆØ¹ÙŠ</div>
          <div class="cmp-val" id="sAvg">0%</div>
        </div>
        <div class="cmp-card">
          <div class="cmp-lbl">Ø£ÙØ¶Ù„ ÙŠÙˆÙ…</div>
          <div class="cmp-val" id="sBest">â€”</div>
        </div>
      </div>
    </div>
  </div>
</div><!-- /sidebar -->

<!-- APP -->
<div id="app">
  <div class="main-col">

    <!-- TOPBAR -->
    <div class="topbar">
      <div class="tb-title">
        <span class="moon">ğŸŒ™</span>
        <span id="dayLabel">Ø£Ù‡Ø¯Ø§ÙÙŠ ÙÙŠ Ø±Ù…Ø¶Ø§Ù†</span>
      </div>
      <div class="tb-actions">
        <div class="theme-row">
          <button class="tbtn light active" id="tb-light" onclick="setTheme('light')">â˜€ï¸</button>
          <button class="tbtn dark"  id="tb-dark"  onclick="setTheme('dark')">ğŸŒ‘</button>
          <button class="tbtn pink"  id="tb-pink"  onclick="setTheme('pink')">ğŸŒ¸</button>
        </div>
        <button class="menu-btn" onclick="openSidebar()">â˜°</button>
      </div>
    </div>

    <!-- MAIN -->
    <main class="main">

      <div class="hero">
        <div class="hero-date" id="heroDate">Ø±Ù…Ø¶Ø§Ù† Ù¡Ù¤Ù¤Ù¦ ğŸŒ™</div>
        <div class="hero-sub"  id="heroSub">Ø§Ø¶ØºØ· "ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯" Ù„ØªØ¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ</div>
        <div class="prog-row">
          <span class="prog-lbl">Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ÙŠÙˆÙ…</span>
          <div class="prog-bar"><div class="prog-fill" id="progFill" style="width:0%"></div></div>
          <span class="prog-pct" id="progPct">0%</span>
        </div>
      </div>

      <div class="sec-title"><span>ğŸŒŸ</span> Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…</div>
      <div class="tasks">

        <!-- FASTING -->
        <div class="card">
          <div class="card-head" onclick="toggleCard('fast')">
            <div class="card-icon ic-fast">ğŸŒ…</div>
            <div class="card-info">
              <div class="card-name">Ø§Ù„ØµÙˆÙ…</div>
              <div class="card-sub" id="subFast">Ù‡Ù„ ØµÙ…Øª Ø§Ù„ÙŠÙˆÙ…ØŸ</div>
            </div>
            <div class="card-arr" id="arr-fast">â–¼</div>
          </div>
          <div class="card-body" id="body-fast" style="display:none">
            <div class="fast-row">
              <button class="fast-btn" id="btnYes" onclick="setFasting(true)">âœ… Ù†Ø¹Ù…ØŒ ØµÙ…Øª</button>
              <button class="fast-btn" id="btnNo"  onclick="setFasting(false)">âŒ Ù„Ù… Ø£ØµÙ…</button>
            </div>
          </div>
        </div>

        <!-- PRAYER -->
        <div class="card">
          <div class="card-head" onclick="toggleCard('pray')">
            <div class="card-icon ic-pray">ğŸ•Œ</div>
            <div class="card-info">
              <div class="card-name">Ø§Ù„ØµÙ„Ø§Ø©</div>
              <div class="card-sub" id="subPray">0 Ù…Ù† 5 ØµÙ„ÙˆØ§Øª</div>
            </div>
            <div class="card-arr" id="arr-pray">â–¼</div>
          </div>
          <div class="card-body" id="body-pray" style="display:none">
            <div class="pray-list" id="prayList"></div>
          </div>
        </div>

        <!-- QURAN -->
        <div class="card">
          <div class="card-head" onclick="toggleCard('quran')">
            <div class="card-icon ic-quran">ğŸ“–</div>
            <div class="card-info">
              <div class="card-name">ÙˆØ±Ø¯ Ø§Ù„Ù‚Ø±Ø¢Ù†</div>
              <div class="card-sub" id="subQuran">0 ØµÙØ­Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
            </div>
            <div class="card-arr" id="arr-quran">â–¼</div>
          </div>
          <div class="card-body" id="body-quran" style="display:none">
            <div class="quran-body">
              <div class="counter-row">
                <span class="cnt-lbl">ğŸ“„ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„ÙŠÙˆÙ…</span>
                <div class="cnt-ctrl">
                  <button class="cnt-btn" onclick="changeQuran(-1)">âˆ’</button>
                  <span class="cnt-val" id="quranNum">0</span>
                  <button class="cnt-btn" onclick="changeQuran(1)">+</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- STUDY -->
        <div class="card">
          <div class="card-head" onclick="toggleCard('study')">
            <div class="card-icon ic-study">ğŸ“š</div>
            <div class="card-info">
              <div class="card-name">Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©</div>
              <div class="card-sub" id="subStudy">0 Ø³Ø§Ø¹Ø§Øª Ù…Ø°Ø§ÙƒØ±Ø©</div>
            </div>
            <div class="card-arr" id="arr-study">â–¼</div>
          </div>
          <div class="card-body" id="body-study" style="display:none">
            <div class="study-body">
              <div class="study-row">
                <span class="study-lbl">â±ï¸ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©</span>
                <div class="hrs-ctrl">
                  <button class="cnt-btn" onclick="changeHours(-0.5)">âˆ’</button>
                  <span class="hrs-val" id="studyNum">0</span>
                  <button class="cnt-btn" onclick="changeHours(0.5)">+</button>
                </div>
              </div>
              <div id="subjList"></div>
              <div class="add-row">
                <input class="add-inp" id="subjInput" placeholder="Ø£Ø¶Ù Ù…Ø§Ø¯Ø©..."
                  onkeypress="if(event.key==='Enter')addSubject()">
                <button class="add-btn" onclick="addSubject()">+ Ø£Ø¶Ù</button>
              </div>
            </div>
          </div>
        </div>

      </div><!-- /tasks -->

      <div class="sec-title" style="margin-top:14px"><span>ğŸ“</span> Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>
      <textarea class="notes-txt" id="notesField"
        placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§..." oninput="autoSave()"></textarea>

      <button class="save-btn" onclick="saveDay()">ğŸ’¾ Ø­ÙØ¸ ÙŠÙˆÙ…ÙŠ</button>
      <div style="height:22px"></div>

    </main>
  </div><!-- /main-col -->
</div><!-- /app -->

<div id="toast"></div>

<script>
/* â”€â”€ DATA â”€â”€ */
const PRAYERS = ['Ø§Ù„ÙØ¬Ø±','Ø§Ù„Ø¸Ù‡Ø±','Ø§Ù„Ø¹ØµØ±','Ø§Ù„Ù…ØºØ±Ø¨','Ø§Ù„Ø¹Ø´Ø§Ø¡'];
const QT = 20, ST = 4;
let day = null;
let db  = load();

function load(){ try{ return JSON.parse(localStorage.getItem('rm2025'))||{}; }catch(e){ return {}; } }
function save(){ localStorage.setItem('rm2025', JSON.stringify(db)); }
function dayData(d){
  if(!db[d]) db[d]={
    fasting:null,
    prayers:{Ø§Ù„ÙØ¬Ø±:null,Ø§Ù„Ø¸Ù‡Ø±:null,Ø§Ù„Ø¹ØµØ±:null,Ø§Ù„Ù…ØºØ±Ø¨:null,Ø§Ù„Ø¹Ø´Ø§Ø¡:null},
    quran:0, hours:0, subjects:[], notes:'', at:null
  };
  return db[d];
}

/* â”€â”€ THEME â”€â”€ */
function setTheme(t){
  document.body.setAttribute('data-theme',t);
  localStorage.setItem('theme',t);
  document.querySelectorAll('.tbtn').forEach(b=>b.classList.remove('active'));
  document.getElementById('tb-'+t).classList.add('active');
}

/* â”€â”€ SIDEBAR â”€â”€ */
function isWide(){ return window.innerWidth >= 768; }

function openSidebar(){
  if(isWide()) return;
  document.getElementById('sidebar').classList.add('open');
  document.getElementById('overlay').classList.add('open');
  buildList(); updateStats();
}
function closeSidebar(){
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('overlay').classList.remove('open');
}

function switchTab(t){
  document.querySelectorAll('.tab-btn').forEach((b,i)=>
    b.classList.toggle('active',(i===0&&t==='days')||(i===1&&t==='stats'))
  );
  document.getElementById('tab-days').classList.toggle('active', t==='days');
  document.getElementById('tab-stats').classList.toggle('active', t==='stats');
  if(t==='stats') updateStats();
}

/* â”€â”€ DAYS â”€â”€ */
function addNewDay(){
  const keys = Object.keys(db).map(Number).filter(n=>!isNaN(n));
  const next  = keys.length ? Math.max(...keys)+1 : 1;
  dayData(next); save();
  day = next;
  buildList();
  if(!isWide()) closeSidebar();
  render(); toast('âœ¨ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ… '+next);
}

function buildList(){
  const el = document.getElementById('daysList');
  el.innerHTML = '';
  const keys = Object.keys(db).map(Number).filter(n=>!isNaN(n)).sort((a,b)=>b-a);
  if(!keys.length){
    el.innerHTML='<div style="text-align:center;opacity:.45;font-size:.8rem;padding:22px 0;line-height:2.1">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠØ§Ù… Ø¨Ø¹Ø¯ ğŸŒ™<br>Ø§Ø¶ØºØ· "ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯" Ù„ØªØ¨Ø¯Ø£</div>';
    return;
  }
  keys.forEach(d=>{
    const sc = score(db[d]);
    const saved = db[d].at
      ? new Date(db[d].at).toLocaleDateString('ar-EG',{day:'numeric',month:'short'})
      : 'Ù„Ù… ÙŠÙØ­ÙØ¸';
    const div = document.createElement('div');
    div.className = 'day-item'+(d===day?' active':'');
    div.innerHTML = `
      <div class="day-badge">${d}</div>
      <div class="day-info">
        <div class="day-title">Ø§Ù„ÙŠÙˆÙ… ${d}</div>
        <div class="day-sub">${saved}</div>
      </div>
      <div class="day-score">${sc}%</div>
      <button class="day-del" onclick="delConfirm(${d},event)">ğŸ—‘ï¸</button>`;
    const go = ()=>{ day=d; render(); if(!isWide()) closeSidebar(); };
    div.querySelector('.day-badge').onclick = go;
    div.querySelector('.day-info').onclick  = go;
    div.querySelector('.day-score').onclick = go;
    el.appendChild(div);
  });
}

function delConfirm(d, e){
  e.stopPropagation();
  const m = document.createElement('div');
  m.className = 'modal-bg';
  m.innerHTML = `
    <div class="modal-box">
      <div class="modal-ico">ğŸ—‘ï¸</div>
      <div class="modal-ttl">Ø­Ø°Ù Ø§Ù„ÙŠÙˆÙ… ${d}ØŸ</div>
      <div class="modal-sub">Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹</div>
      <div class="modal-row">
        <button class="modal-btn m-cancel" id="mCnl">Ø¥Ù„ØºØ§Ø¡</button>
        <button class="modal-btn m-del"    id="mDel">Ø­Ø°Ù</button>
      </div>
    </div>`;
  document.body.appendChild(m);
  document.getElementById('mCnl').onclick = ()=> m.remove();
  m.onclick = e2=>{ if(e2.target===m) m.remove(); };
  document.getElementById('mDel').onclick = ()=>{
    m.remove();
    delete db[d]; save();
    const rem = Object.keys(db).map(Number).filter(n=>!isNaN(n));
    if(!rem.length){ day=null; buildList(); emptyState(); }
    else { if(d===day){ day=Math.max(...rem); render(); } buildList(); }
    toast('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„ÙŠÙˆÙ… '+d);
  };
}

/* â”€â”€ RENDER â”€â”€ */
function emptyState(){
  document.getElementById('dayLabel').textContent = 'Ø£Ù‡Ø¯Ø§ÙÙŠ ÙÙŠ Ø±Ù…Ø¶Ø§Ù†';
  document.getElementById('heroDate').textContent = 'Ø±Ù…Ø¶Ø§Ù† Ù¡Ù¤Ù¤Ù¦ ğŸŒ™';
  document.getElementById('heroSub').textContent  = 'Ø§Ø¶ØºØ· "ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯" Ù„ØªØ¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ';
  document.getElementById('progFill').style.width = '0%';
  document.getElementById('progPct').textContent  = '0%';
}

function render(){
  if(day===null){ emptyState(); return; }
  const d = dayData(day);
  document.getElementById('dayLabel').textContent = 'Ø§Ù„ÙŠÙˆÙ… '+day;
  document.getElementById('heroDate').textContent = 'Ø§Ù„ÙŠÙˆÙ… '+day+' Ù…Ù† Ø±Ù…Ø¶Ø§Ù† Ù¡Ù¤Ù¤Ù¦';
  document.getElementById('heroSub').textContent  = 'Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ… âœ¨';
  rFast(d); rPray(d); rQuran(d); rStudy(d);
  document.getElementById('notesField').value = d.notes||'';
  rProg();
}

function rFast(d){
  document.getElementById('btnYes').className = 'fast-btn'+(d.fasting===true?' sel-yes':'');
  document.getElementById('btnNo').className  = 'fast-btn'+(d.fasting===false?' sel-no':'');
  document.getElementById('subFast').textContent =
    d.fasting===true?'âœ… ØµØ§Ø¦Ù… Ø§Ù„ÙŠÙˆÙ…': d.fasting===false?'âŒ Ù…ÙØ·Ø± Ø§Ù„ÙŠÙˆÙ…':'Ù‡Ù„ ØµÙ…Øª Ø§Ù„ÙŠÙˆÙ…ØŸ';
}

function rPray(d){
  const el = document.getElementById('prayList');
  el.innerHTML = '';
  let done = 0;
  PRAYERS.forEach(p=>{
    const s = d.prayers?.[p] || null;
    if(s==='done') done++;

    const row = document.createElement('div');
    row.className = 'pray-item';

    const nm = document.createElement('span');
    nm.className = 'pray-name'; nm.textContent = p;

    const bw = document.createElement('div');
    bw.className = 'pray-btns';

    const b1 = document.createElement('button');
    b1.className = 'pray-btn'+(s==='done'?' on-done':'');
    b1.textContent = 'âœ… ÙÙŠ ÙˆÙ‚ØªÙ‡Ø§';
    b1.onclick = ()=> setPray(p,'done');

    const b2 = document.createElement('button');
    b2.className = 'pray-btn'+(s==='qada'?' on-qada':'');
    b2.textContent = 'â° Ù‚Ø¶Ø§Ø¡';
    b2.onclick = ()=> setPray(p,'qada');

    bw.append(b1,b2);
    row.append(nm,bw);
    el.appendChild(row);
  });
  document.getElementById('subPray').textContent = done+' Ù…Ù† 5 ØµÙ„ÙˆØ§Øª';
}

function rQuran(d){
  const p = d.quran||0;
  document.getElementById('quranNum').textContent  = p;
  document.getElementById('subQuran').textContent  = p+' ØµÙØ­Ø§Øª Ø§Ù„ÙŠÙˆÙ…';
}

function rStudy(d){
  document.getElementById('studyNum').textContent  = d.hours||0;
  document.getElementById('subStudy').textContent  = (d.hours||0)+' Ø³Ø§Ø¹Ø§Øª Ù…Ø°Ø§ÙƒØ±Ø©';
  const el = document.getElementById('subjList');
  el.innerHTML = '';
  (d.subjects||[]).forEach((s,i)=>{
    const row = document.createElement('div');
    row.className = 'sbj-item'+(s.done?' done':'');

    const chk = document.createElement('div');
    chk.className = 'sbj-chk'; chk.textContent = s.done?'âœ“':'';
    chk.onclick = ()=> toggleSubj(i);

    const nm = document.createElement('span');
    nm.className = 'sbj-name'; nm.textContent = s.name;

    const del = document.createElement('span');
    del.className = 'sbj-del'; del.textContent = 'âœ•';
    del.onclick = e=>{ e.stopPropagation(); delSubj(i); };

    row.append(chk, nm, del);
    el.appendChild(row);
  });
}

function rProg(){
  if(day===null) return;
  const p = score(dayData(day));
  document.getElementById('progFill').style.width = p+'%';
  document.getElementById('progPct').textContent  = p+'%';
}

function score(d){
  if(!d) return 0;
  let s = 0;
  if(d.fasting===true) s+=25;
  s += Math.round(PRAYERS.filter(p=>d.prayers?.[p]==='done').length/5*35);
  s += Math.round(Math.min(1,(d.quran||0)/QT)*25);
  s += Math.round(Math.min(1,(d.hours||0)/ST)*15);
  return s;
}

/* â”€â”€ TOGGLES â”€â”€ */
function toggleCard(n){
  const b = document.getElementById('body-'+n);
  const a = document.getElementById('arr-'+n);
  const opening = b.style.display==='none';
  b.style.display = opening ? 'block' : 'none';
  a.textContent   = opening ? 'â–²' : 'â–¼';
  if(opening && day!==null){
    const d = dayData(day);
    if(n==='pray')  rPray(d);
    if(n==='quran') rQuran(d);
    if(n==='study') rStudy(d);
    if(n==='fast')  rFast(d);
  }
}

function setFasting(v){
  const d = dayData(day); d.fasting = d.fasting===v?null:v;
  rFast(d); rProg(); autoSave();
}

function setPray(p, s){
  const d = dayData(day);
  if(!d.prayers) d.prayers={Ø§Ù„ÙØ¬Ø±:null,Ø§Ù„Ø¸Ù‡Ø±:null,Ø§Ù„Ø¹ØµØ±:null,Ø§Ù„Ù…ØºØ±Ø¨:null,Ø§Ù„Ø¹Ø´Ø§Ø¡:null};
  d.prayers[p] = d.prayers[p]===s ? null : s;
  rPray(d); rProg(); autoSave();
}

function changeQuran(delta){
  const d = dayData(day); d.quran = Math.max(0,(d.quran||0)+delta);
  rQuran(d); rProg(); autoSave();
}

function changeHours(delta){
  const d = dayData(day);
  d.hours = Math.max(0, Math.round(((d.hours||0)+delta)*2)/2);
  rStudy(d); rProg(); autoSave();
}

function addSubject(){
  const inp = document.getElementById('subjInput');
  const v = inp.value.trim(); if(!v) return;
  dayData(day).subjects.push({name:v,done:false});
  inp.value=''; rStudy(dayData(day)); autoSave();
}

function toggleSubj(i){
  const d = dayData(day); d.subjects[i].done = !d.subjects[i].done;
  rStudy(d); autoSave();
}

function delSubj(i){
  const d = dayData(day); d.subjects.splice(i,1);
  rStudy(d); autoSave();
}

function autoSave(){
  if(day===null) return;
  const d = dayData(day);
  d.notes = document.getElementById('notesField').value;
  d.at = Date.now(); save();
}

function saveDay(){
  if(day===null){ toast('â— Ø£Ù†Ø´Ø¦ ÙŠÙˆÙ…Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹!'); return; }
  autoSave(); toast('âœ… ØªÙ… Ø­ÙØ¸ ÙŠÙˆÙ…Ùƒ!');
  buildList(); updateStats();
}

/* â”€â”€ STATS â”€â”€ */
function updateStats(){
  if(day===null) return;
  const ts = score(db[day]), ps = score(db[day-1]);
  document.getElementById('sTodayPct').textContent = ts+'%';
  document.getElementById('sYestPct').textContent  = ps+'%';

  const tr = document.getElementById('sTrend');
  if(!db[day-1])    tr.innerHTML='<span class="trend trend-eq">ğŸ“… Ø£ÙˆÙ„ ÙŠÙˆÙ… ØªØªØ¨Ø¹Ù‡</span>';
  else if(ts>ps)    tr.innerHTML=`<span class="trend trend-up">ğŸ“ˆ ØªØ­Ø³Ù†Øª Ø¨Ù€ ${ts-ps}% Ø¹Ù† Ø£Ù…Ø³</span>`;
  else if(ts<ps)    tr.innerHTML=`<span class="trend trend-dn">ğŸ“‰ Ø§Ù†Ø®ÙØ¶ ${ps-ts}% Ø¹Ù† Ø£Ù…Ø³</span>`;
  else              tr.innerHTML='<span class="trend trend-eq">â¡ï¸ Ù†ÙØ³ Ø£Ø¯Ø§Ø¡ Ø£Ù…Ø³</span>';

  const dd = db[day]||{};
  document.getElementById('sFast').textContent   = !db[day]?'â€”':dd.fasting===true?'âœ…':dd.fasting===false?'âŒ':'â€”';
  const pd = PRAYERS.filter(p=>dd.prayers?.[p]==='done').length;
  document.getElementById('sPray').textContent   = pd+'/5';
  document.getElementById('sPrayBar').style.width  = (pd/5*100)+'%';
  const qp = dd.quran||0;
  document.getElementById('sQuran').textContent  = qp+' ØµÙØ­Ø§Øª';
  document.getElementById('sQuranBar').style.width = Math.min(100,qp/QT*100)+'%';
  const sh = dd.hours||0;
  document.getElementById('sStudy').textContent  = sh+' Ø³Ø§Ø¹Ø§Øª';
  document.getElementById('sStudyBar').style.width = Math.min(100,sh/ST*100)+'%';

  const allD = Object.keys(db).map(Number).filter(n=>!isNaN(n)).sort((a,b)=>a-b);
  const last7 = allD.slice(-7);
  const ch = document.getElementById('wChart'); ch.innerHTML='';
  const sc7 = last7.map(d=>score(db[d]));
  last7.forEach((d,i)=>{
    const w = document.createElement('div'); w.className='wbar-w';
    w.innerHTML=`<div class="wbar-c"><div class="wbar" style="height:${sc7[i]}%"></div></div><div class="wbar-l">ÙŠ${d}</div>`;
    ch.appendChild(w);
  });
  const valid = sc7.filter((_,i)=>db[last7[i]]);
  const avg = valid.length ? Math.round(valid.reduce((a,b)=>a+b,0)/valid.length) : 0;
  document.getElementById('sAvg').textContent  = avg+'%';
  const bi = sc7.indexOf(Math.max(...sc7));
  document.getElementById('sBest').textContent = sc7[bi]>0 ? 'ÙŠ'+last7[bi] : 'â€”';
}

/* â”€â”€ TOAST â”€â”€ */
function toast(msg){
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 2400);
}

/* â”€â”€ INIT â”€â”€ */
function init(){
  setTheme(localStorage.getItem('theme')||'light');
  const keys = Object.keys(db).map(Number).filter(n=>!isNaN(n));
  if(keys.length){
    day = Math.max(...keys);
  } else {
    // First launch â€” auto-create Day 1
    dayData(1); save(); day = 1;
  }
  render();
  const b = document.getElementById('body-fast');
  b.style.display='block';
  document.getElementById('arr-fast').textContent='â–²';
  buildList(); updateStats();
  const g=['Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ… ğŸŒ™','Ø¨Ø§Ø±Ùƒ Ø§Ù„Ù„Ù‡ ÙÙŠÙƒ âœ¨','Ø§Ù„Ù„Ù‡Ù… Ø¨Ù„ØºÙ†Ø§ Ø±Ù…Ø¶Ø§Ù† ğŸ¤²'];
  toast(g[Math.floor(Math.random()*g.length)]);
}
init();
</script>
  <script type="module">
  // Ø¨Ù†Ù†Ø§Ø¯ÙŠ Ø¹Ù„Ù‰ Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù„ÙŠ Ø·Ø¨Ø®Ù†Ø§Ù‡Ø§ ÙÙŠ Ø§Ù„Ù…ÙƒÙŠÙ†Ø©
  import { LocalNotifications } from 'https://cdn.jsdelivr.net/npm/@capacitor/local-notifications@latest/+esm';

  async function startNotifications() {
    // 1. Ø¨Ù†Ø·Ù„Ø¨ Ø¥Ø°Ù† Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù„Ø§Ø²Ù… ÙŠÙˆØ§ÙÙ‚ Ø§Ù„Ø£ÙˆÙ„)
    const permission = await LocalNotifications.requestPermissions();
    
    if (permission.display === 'granted') {
      // 2. Ø¨Ù†Ù…Ø³Ø­ Ø£ÙŠ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù‚Ø¯ÙŠÙ…Ø© Ø¹Ø´Ø§Ù† Ù…ÙŠØªÙ„Ø®Ø¨Ø·Ø´
      await LocalNotifications.removeAllDeliveredNotifications();

      // 3. Ø¨Ù†Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
      await LocalNotifications.schedule({
        notifications: [
          {
            title: "ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù† Ø¹Ù…Ù†Ø§",
            body: "Ø§ÙŠÙ‡ ÙŠØ§ Ø¹Ù…Ù†Ø§ Ø§Ù†Øª Ù†Ø³ÙŠØª Ø§Ù„Ù„ÙŠ Ø¹Ù„ÙŠÙƒ ÙˆÙ„Ø§ Ø§ÙŠÙ‡ØŸ",
            id: 1,
            schedule: { at: new Date(Date.now() + 1000 * 10) } // Ù‡ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ 10 Ø«ÙˆØ§Ù†ÙŠ Ù„Ù„ØªØ¬Ø±Ø¨Ø©
          },
          {
            title: "ØªØ­Ø°ÙŠØ± Ø§Ù„Ø£Ø®ÙŠØ±",
            body: "Ø¨Øµ ÙŠØ§Ø¨Ù†ÙŠ Ø§Ù†Ø§ Ø§Ø³ØªØ­Ù…Ù„ØªÙƒ ÙƒØªÙŠØ± ÙˆØ¯Ù‡ Ø¶Ø¯ Ø·Ø¨ÙŠØ¹ØªÙŠ",
            id: 2,
            schedule: { at: new Date(Date.now() + 1000 * 60 * 5) } // Ø¨Ø¹Ø¯ 5 Ø¯Ù‚Ø§Ø¦Ù‚
          },
          {
            title: "Ø°ÙƒØ±",
            body: "ØµÙ„ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ",
            id: 3,
            schedule: { 
              at: new Date(Date.now() + 1000 * 60 * 60), // Ø¨Ø¹Ø¯ Ø³Ø§Ø¹Ø©
              repeats: true // ÙŠØªÙƒØ±Ø± ÙƒÙ„ Ø³Ø§Ø¹Ø©
            }
          }
        ]
      });
      console.log("ØªÙ… Ø¶Ø¨Ø· Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
    }
  }

  // Ø¨Ù†Ø´ØºÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¯ÙŠ Ø£ÙˆÙ„ Ù…Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠÙØªØ­
  startNotifications();
</script>
</body>
</html>
